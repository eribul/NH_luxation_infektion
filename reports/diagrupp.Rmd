---
title: "Diagnosgrupp"
author: "Erik Bulow"
date: '2020-04-27'
output: 
  html_document:
    df_print: kable
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
con <- shar_linkage_con()
```

# Källa 

Jag lyckas tyvärr inte hitta någon definition av hur grupperingen av enskilda diagnoser går till.
Denna gruppering är redan gjord i det dataset jag har tillgång till. Jag kan dock se vilka kombinationer som förekommer rent empiriskt:

# Översättningar

Grupperingen nedan utgår från den svenska variabelnamn. Den översättning som användes är följande (behöver kanske korrigeras). Observera att endast inkluderade diagnosgrupper översatts och att det alltså finns fler i tabellen nedan:

```{r}
tibble(
  se = c(
       "Primär artros",
       "Annan sekundär artros",
       "Följdtillstånd efter barnsjukdom i höftleden",
       "Idiopatisk nekros",
       "Inflammatorisk ledsjukdom",
       "Komplikation eller följdtillstånd efter fraktur el annat trauma"
    ),
  en = c(
       "Primary osteoarthritis",
       "Secondary osteoarthritis",
       "Childhood disease",
       "Idiopathic necrosis",
       "Inflammatory joint disease",
       "Sequelae"
     )
  ) %>% 
  arrange(se)
```

# Gruppering

```{r}
diags_tmp <- 
  tbl(con, "primary") %>% 
  select(P_DiaGrp, P_Diagnosis) %>% 
  count(P_DiaGrp, P_Diagnosis, sort = TRUE) %>% 
  collect() 

diags <- 
  diags_tmp %>% 
  ungroup() %>% 
  mutate_all(na_if, "NA") %>% 
  filter(!is.na(P_DiaGrp)) %>%
  arrange(P_DiaGrp) %>% 
  mutate(P_DiaGrp = replace(P_DiaGrp, duplicated(P_DiaGrp), ""))

diags
```


